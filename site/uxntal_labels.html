<!DOCTYPE html><html><head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property='og:type' content='website'/>
<meta property='og:site_name' content='XXIIVV'/>
<meta property='og:description' content="By Devine Lu Linvega"/>
<meta property='og:logo' content="https://wiki.xxiivv.com/media/services/rss.jpg"/>
<link href="../links/main.css" type="text/css" rel="stylesheet">
<link href="../media/services/icon.png" type="image/png" rel="shortcut icon">
<link href="../links/img.xml" type="application/rss+xml" rel="alternate" title="XXIIVV" />
<meta property="og:title" content="uxntal labels"/>
<meta property="og:url" content="https://wiki.xxiivv.com/site/uxntal_labels.html"/>
<meta property="og:image" content="https://wiki.xxiivv.com/media/services/rss.jpg"/>
<title>XXIIVV &mdash; uxntal labels</title>
</head>
<body>
<header><a href="home.html"><img alt="XXIIVV" src="../media/icon/xxiivv_cursive.png" width="200"></a></header>
<nav><ul><li><a href="uxntal.html" class="parent">uxntal</a></li><li><a href="varvara.html">varvara</a></li><li><a href="porporo.html">porporo</a></li></ul><ul><li><a href="uxntal_stacks.html">uxntal stacks</a></li><li><a href="uxntal_notation.html">uxntal notation</a></li><li><a href="uxntal_numbers.html">uxntal numbers</a></li><li><a href="uxntal_opcodes.html">uxntal opcodes</a></li><li><a href="uxntal_labels.html" class="self">uxntal labels</a></li><li><a href="uxntal_strings.html">uxntal strings</a></li><li><a href="uxntal_macros.html">uxntal macros</a></li><li><a href="uxntal_memory.html">uxntal memory</a></li><li><a href="uxntal_devices.html">uxntal devices</a></li><li><a href="uxntal_software.html">uxntal software</a></li></ul><ul><li><a href="uxntal_doors.html">uxntal doors</a></li></ul></nav>
<main><h2>Uxntal Labels</h2>

<p>A label is a non-<a href='uxntal_numbers.html'>numeric</a>, non-<a
href='uxntal_opcodes.html'>opcode</a>, and non-runic symbol that correspond
to a number between 0 and 65536. A label name is made of two parts, a scope and
a sublabel. Sublabels can be added to a scope with the <kbd>&name</kbd> rune,
or by writing the full name, like <kbd>@scope/name</kbd>. Note that a labels
like <i>bed</i>, <i>add</i> and <i>cafe</i> are considered numeric.</p>

<p><b>Functions</b> are simply labels that will be jumped to, and returned
from.</p>

<pre>
<b>@func</b> <i>( a b -- c )</i>
	&loop
		INC GTHk ?&loop
	ADD JMP2r
</pre>

<p id='constants'><b>Constants</b> are labels that hold a specific value through the entire
execution of the program. They allow to assign a name to a number, making the
code more readable.</p>

<pre>
|1400 <b>@text/sz</b>
|2000 <b>@text/buf</b> $&sz
</pre>

<p><b>Enums</b> are labels with padded members of equal sizes that can be used as
constants in a program, they typically begin by rolling back the program
address with <kbd><a href='uxntal_memory.html#absolute'>|00</a></kbd>:</p>

<pre>
|00 <b>@Suit</b> &clubs $1 &diamonds $1 &hearts $1 &spades
</pre>

<p id='structs'><b>Structs</b> are labels with padded members of different sizes,
that maps on a data-structure, they typically space the different members with
<kbd><a href='uxntal_memory.html#relative'>$1</a></kbd>:</p>

<pre>
|00 <b>@Person</b> &name $2 &age $1 &height $2
</pre>

<p>Labels can also be used with the padding runes to define a
global length. For example, if one needs to specify a length of 0x30 for
multiple members of a struct, a value can be specified as follow:</p>

<pre>
|30 <b>@length</b>
|00 <b>@Struct</b> &field $length
</pre>

<h3 id='scope'>Scope</h3>

<p>Uxntal objects are defined statically and allow for the enclosed methods to
access encapsulated local <kbd>&members</kbd>. The example below contains an
object with the method <kbd>set-color</kbd>, accessible from outside the scope
as <kbd>pen/set-color</kbd>.</p>

<pre>
<b>@pen</b>
	&position &x $2 &y $2
	&color $1

&set-color <i>( color -- )</i>
	,/color STR
	JMP2r
</pre>

<p>New methods and members can extend an existing scope from anywhere by creating
a label with the scope name followed by a slash and the name of the extension.
The <kbd>&labels</kbd> declared within the extension have the same access to
local labels as the rest of the object.</p>

<pre>
<b>@pen/get-position</b> <i>( -- x* y* )</i>
	,/x LDR2 ,/y LDR2
	JMP2r
</pre>

<p id='method'>When calling local methods the scope's name can be omitted,
starting at the slash, like <kbd>/method</kbd>:</p>

<pre>
<b>@pen/paint</b> <i>( -- )</i>
	/get-position canvas/draw-line-to
	JMP2r
</pre>

<q>The notion of an interface is what truly characterizes objects - not classes, not inheritance, not mutable state.</q>
<cite>Gilad Bracha</cite>

<h3 id='addressing'>Addressing</h3>

<p>A labels is a way of assigning a name to a number. There are six ways to get
the number corresponding to that label. Literal addressing prefixes the label
with a <code>LIT</code> for Relative and Zero-Page addressing, and
<code>LIT2</code> for absolute addressing.</p>

<ul>
	<li id='litrel'><b>Literal Relative</b>, like <kbd>,label</kbd>, pushes a
relative distance byte to the label.</li>
	<li id='litzep'><b>Literal Zero-Page</b>, like <kbd>.label</kbd>, pushes an
absolute address byte to the label.</li>
	<li id='litabs'><b>Literal Absolute</b>, like <kbd>;label</kbd>, pushes an
absolute address short to the label.</li>
	<li id='rawrel'><b>Raw Relative</b>, like <kbd>_label</kbd>, writes a
relative distance byte to the label.</li>
	<li id='rawzep'><b>Raw Zero-Page</b>, like <kbd>-label</kbd>, writes an
absolute address byte to the label.</li>
	<li id='rawabs'><b>Raw Absolute</b>, like <kbd>=label</kbd>, writes an
absolute address short to the label.</li>
</ul>

<p>Raw addressing is used for building data-structures and more advanced
programs. A relatively common usage of raw runes is to create literals directly
into the return stack:</p>

<pre>
[ LIT2r 08 -label ] LDZr ADDr <span style='float:right'>| [.label]+8</span>
</pre>

<h3 id='anonymous'>Anonymous Labels</h3>

<p>Anonymous labels are designated with a curly bracket that points to its
associated closing bracket, and can be nested. Under the hood, the opening
bracket assembles to the address of the closing bracket which allows the
destination address to be used like any other label such as a JCI
<kbd>?{</kbd>, a JMI, <kbd>!{</kbd> or a plain literal <kbd>;{</kbd>. Here are
some example data-structures:</p>

<pre>
<b>@counted-string</b>
	_{ "foo 20 "bar }

<b>@linked-list</b>
	={ ={ "A } ={ "B ={ "C } } }
</pre>

<h4 id='unless'>Unless Blocks</h4>

<p>It is important to notice that in the case of a conditional jump, the
lambda's content is <b>jumped over when the flag byte is true</b>.</p>

<pre>
[ LIT2 &last $1 -Mouse/state ] DEI DUP ,&last STR
DUP2 #0001 NEQ2 ?{ ( on down ) }
DUP2 #0101 NEQ2 ?{ ( on drag ) }
DUP2 #0100 NEQ2 ?{ ( on release ) }
POP2
</pre>

<p>The opening curly bracket assembles to a unique label reference, and the
closing bracket to a corresponding matching label definition. They do not
affect the scope.</p>

<h2>Uxntal Doors</h2>

<p>The ability to treat instructions as data makes programs that write programs
possible. <b>Self-modifying code</b>(SMC) is generally considered harmful, and is
therefore not permitted in most modern computer architectures today.</p>

<article>
	<p><b>Action at a distance</b> is an anti-pattern in computer science in which
behavior in one part of a program modifies operations in another part of the
program. This anti-pattern should be avoided whenever possible, but if wielded
carefully SMC can become a practical ally when writing Uxntal.</p>
</article>

<p>A door is an allocation of local memory that can store state across
vectors.</p>

<pre>
@routine <i>( -- i )</i>
	[ LIT &door $1 ] INCk ,&door STR
	JMP2r
</pre>

<h3>Caching Doors</h3>

<p>In most cases, SMC is used to cache data that would otherwise be difficult or
slow to retrieve, like when writing a responsive application that would make
frequent requests to a device.</p>

<p>In the following door, we are comparing the state of the mouse device
between vector events, we could store the previous state in a zero-page
variable, but keeping the value locally allows to reserve a byte from within
the context where it is needed, and is faster by being inlined.</p>

<pre>
@on-mouse ( -> )
	[ LIT2 &last $1 -Mouse/state ] DEI 
		DUP ,&last STR
		EORk ?&changed 
	POP2
	BRK</pre>

<h3>Callback Doors</h3>

<p>To chain operations across vectors, one might try passing the next operation
pointer on the stack, but since we cannot be certain which vector will happen
next, we can't expect a specific stack state between events. A safer
way is to write the next operation directly into a door where it will be
needed, ideally preserving the label scope.</p>

<pre>
@set-animation ( callback* -- )
	,&callback STR2
	;&run .Screen/vector DEO2
	JMP2r

&run ( -> )
	[ LIT &time f0 ] 
		INCk ,&time STR
		#00 EQU ?&done
	try-redraw
	BRK

&done ( -> )
	[ LIT2 &callback $2 ] JSR2
	BRK
</pre>

<h3>Depth-Punching Doors</h3>

<p>Routines should try and avoid accessing stack values that are further than 2
or 3 shorts deep on either stacks, but sometimes it cannot be helped. In the
following example, we want to run a function over each value of a 2d array.
Instead of juggling the stacks on each iteration to bring out the function
pointer, it is often more efficient to write the function pointer across the
nested loop.</p>

<pre>
@each-pixel ( fn* -- )
	,&fn STR2
	#1000
	&h
		STHk
		#2000
		&x
			DUP STHkr [ LIT2 &fn $2 ] JSR2
			INC GTHk ?&x
		POP2
		POPr
		INC GTHk ?&h
	POP2
	JMP2r
</pre>

<ul></ul><p><b>incoming: </b><a href="drifblim.html">drifblim</a> <a href="uxntal.html" class="parent">uxntal</a> <a href="uxntal_strings.html">uxntal strings</a> <a href="uxntal_macros.html">uxntal macros</a> <a href="2025.html">2025</a> <a href="2024.html">2024</a> <a href="2023.html">2023</a> </p></main>
<footer>
	<a href="uxn.html"><img src="../media/icon/uxn.png" alt="Uxn Powered"/></a> 
	<a href="ethics.html"><img src="../media/icon/3arrows.png" alt="NoNazis!"/></a>
	<a href="devine_lu_linvega.html">Devine Lu Linvega</a> <span> &bull; 2008-2026</span>
	<div class="right"><a href="about.html#license">BY-NC-SA 4.0</a>
		<a href="https://creativecommons.org/licenses/by-nc-sa/4.0" target="_blank"><img src="../media/icon/cc.png" alt="CreativeCommons"/></a>
		<a href="https://webring.xxiivv.com/" target="_blank"><img src="../media/icon/rotonde.png" alt="Webring"/></a>
		<a href="https://merveilles.town/@neauoire" rel="me" target="_blank"><img src="../media/icon/merveilles.png" alt="Merveilles"/></a>
	</div>
	<hr/>
</footer>
</body></html>